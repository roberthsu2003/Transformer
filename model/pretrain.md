# Model的預訓練
- 僅使用tokenizer和model
- 使用原生pytorch做預訓練
- 複雜度較高
- 當使用huggingface的dataset,evaluate,trainer,可以簡單化目前的流程

## 使用的資料集
- [SophonPlus](https://github.com/SophonPlus/ChineseNlpCorpus)
- 資料夾內有提供轉換為繁體中文的檔案(ChnSentiCorp_htl_all.csv)

## 載入數據

```python
#載入數據
import pandas as pd

data = pd.read_csv('./ChnSentiCorp_htl_all.csv')
data.head()
```

**清理數據**

```python
#清理數據
data = data.dropna()
data.info()

#==output==
<class 'pandas.core.frame.DataFrame'>
Index: 7765 entries, 0 to 7765
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   label   7765 non-null   int64 
 1   review  7765 non-null   object
dtypes: int64(1), object(1)
memory usage: 182.0+ KB
```

**取出第1筆資料**

```python
data.iloc[0]['review'], data.iloc[0]['label']

#==output==
('距離川沙公路較近,但是公交指示不對,如果是"蔡陸線"的話,會非常麻煩.建議用別的路線.房間較為簡單.', np.int64(1))
```

## 建立pytorch的Dataset
[**pytorch DataSet的簡單範例**](./pytorch_dataset.md)

**建立自訂Dataset類別**

```
from torch.utils.data import Dataset

class MyDataset(Dataset):
    def __init__(self):
        super().__init__()
        self.data = pd.read_csv('./ChnSentiCorp_htl_all.csv')
        self.data = self.data.dropna()

    def __len__(self):
        return len(self.data)
    
    def __getitem__(self, index):
        return self.data.iloc[index]['review'], self.data.iloc[index]['label']
```

**取出前5筆資料**

```python
dataset = MyDataset()
for index in range(5):
    print(dataset[i])
```

**切割資料集,分為訓練用和驗証用**

```python
from torch.utils.data import random_split
dataset = MyDataset()
trainset, validset = random_split(dataset, lengths=[0.9, 0.1]) #lengths是比例,2個加總必需是1,會隨機分配,不會依照順序
print(trainset)

len(trainset), len(validset)

#==output==
<torch.utils.data.dataset.Subset object at 0xffff1c4e54c0>
(6989, 776)
```

## 建立DataLoader
- dataloader可以使用批次方式載入資料
- 有數值的部份會自動轉成tensor
- 文字部份不會自動轉成tensor

```python
from torch.utils.data import DataLoader

trainloader = DataLoader(trainset, batch_size=32, shuffle=True)
validloader = DataLoader(validset, batch_size=64, shuffle=True)

next(enumerate(trainloader))[1]

#==output==
[('這個價格來說酒店糟透了.大堂很差很髒,我訂的是商務套房,客廳里居然窗戶都沒有,燈光昏暗.所有的洗淑用品包括毛巾質量都很差.房間有一股味道.用我的筆記本上網時好時壞,到後來索性就連不上了,我只好用自己的無線都比它的強.反正以後不會再考慮這家了',
  '如果去大同能接受這個價錢建議住這家酒店,房間夠大,衛生間的設施很不錯!吃不慣山西面食就在酒店一樓的拉丁餐廳吃自助餐,菜式很好.',
  '衛生條件還行,價格也還可以,酒店人員的服務態度也還可以。可付費使用的個人衛生用品(全棉內褲、襪子、無菌毛巾及安全套等)準備的比較齊全。不足之處是房間隔音太差，隔壁和走廊的動靜聽得一清二楚，而且隔壁吵到很晚，影響休息。另外整個房間沒有地毯，但衛生間的門口至少應該放一小塊，用於吸水和洗澡後防滑和吸水。',
  '酒店位置比較隱祕，開車兜了新會一圈才找到。酒店環境非常好，房間設施也很新，大大超出預料，就是房間比較小，廁所很擠。下次去新會還會住這裡。',
  '我們定的是特價大床房，很幸運，去了就免費升級成豪華大床房了。位於四樓，房間還算寬敞，而且很乾淨。我喜歡洗手間的玻璃屏風，這樣顯得整個房間比較大。不喜歡透明的話還可以放下捲簾。這兒的床很好。床旁邊的檯燈也漂亮。唯一毛病是淋浴房門無法合緊，洗澡的時候要拽著門，防止水濺出。好在只住一晚，這點小困難還可以克服。總的來講，三百元就住到這樣的旅館，價效比已經非常好了。',
  '交通方便，周邊也熱鬧，房間小在香港那是自然的了，總的說來是物有所值了。',
  '非常好的酒店,除了前臺的服務態度.房間設施非常好,飛利浦的液晶彩電,還有電腦備用.只是,可能因為是通過攜程預定而非直接預定的原因,房間的位置非常差.',
  '酒店環境還好，在當地算是很好的了，房間比較大，但裝置就一般了。免費註冊網站導航賓館索引服務說明關於攜程誠聘英才代理合作廣告業務聯絡我們Copyright1999-2008,ctrip.com.allrightsreserved.',
  '位置還比較好找，交通、娛樂、購物都比較方便，服務一般化，進門都沒人理，房間太小了，隔音很差，早餐品種太少又不好吃，弄髒了一塊小毛巾又不是洗不掉就讓我陪10塊錢，房費已經預付了，結帳時只需要退我押金就好了，結果等了將近半個小時，前臺就一個人，對這個酒店很失望！',
  '入住了三天，真的不錯，早餐很豐富，中西都有，特別是很受我們大城市人的喜愛．六樓的中餐就差了點，海鮮不多，且價格還是高了點，但觀景桌只有４個少了點，晚去就坐不到了．茶餐廳的小吃還是可以，人氣也比較旺．客房１樓是完全沒有陽臺的，二樓以上每層也只有８個陽臺，訂房時還是最好問清楚．客房的顏色很浪漫．賓館的地理位置是沒話好說了，確實不錯，靠海每間客房都能看到對岸的鼓浪嶼，渡口就在對面，中山路就在邊上．本人恰好有天生日，賓館還是很人心化，送了個小小的生日蛋糕，身在他鄉感覺還是有點驚喜！謝謝賓館的總經理：吳佩英，送來代表賓館的賀卡和祝福．總得來說服務還是不錯的．補充點評2008年8月10日：我會推薦給我的朋友們的．',
  '感覺還算可以的，不過沒有香格里拉那麼好，價格和協議的也沒什麼區別．所以還是去香格里拉較划算點．',
  '服務還好，早餐不錯，酒店位置不錯，值得推薦',
  '衛生總的是挺好～細節上，有點點瑕疵．我很喜歡房間的佈局～周圍的環境真的很安靜，在旅途勞頓後睡了香香覺～嘿嘿，不過成都的門牌號不規範，找了一下下才找到的．服務相對還說是不錯的了',
  '地理環境不錯，但對面一直在蓋樓，門前的街道打車不方便。',
  '晚上航班晚點。22點以後酒店不提供，要去接機需要付費。預定的房間沒有了。酒店給升級到了套間。很大，很好。也許我到店太晚了，沒聽見什麼飛機起降的聲音。如果是在北京轉機，藍天還不錯。',
  '酒店設施尚可,房間內鏡子太多.攜程的套餐包括送水果,還有巧克力,比較溫馨.服務一般,入住時前臺試圖誘導我買早餐,兩大一小每天早餐440元,兩天共計880元,另外冰箱裡的東西可以隨便吃,被我拒絕了!第二天就不再送水果巧克力了,連免費的兩瓶水也不給了...酒店離九龍又一城步行約15分鐘,旁邊有個公園,但是離地鐵遠了點,需要做小巴,有時6元每人,有時3元每人,開得飛快很嚇人,小孩同樣費用,就是這點不滿意,還是住得離地鐵近些比較方便.',
  '位置很好,房間和設施很舊.服務1*.結帳時還經歷前臺服務員凶客人.補充點評2007年12月9日：攜程為什麼不把對面的香格里拉發展為夥伴呢?下次去住香格里拉,可能要通過億龍網定了.',
  '的確很靠近火車站及汽車北站，走路不超過15分鐘。房間裡擺放了3本推薦的新書，其中一本是童話雙語的，感覺很好。不知道為什麼房間裡不備電話簿。',
  '我入住的是酒店豪華單人房，酒店房間設施基本滿意，就是衛生間浴池上掉牆皮，而且熱水放一會才熱，早餐在22樓觀光餐廳，豐富服務周到，比較滿意~~',
  '第五次為貴賓客戶入住，值得推薦！服務沒話說！',
  '在上海光大這個地區,如家的價格還是非常好的!它的對門以前是一個老的國營旅館(名稱叫酒店,其實也就是旅館)服務實在噁心:你想長住,不僅不優惠,在房間緊張的時候還哄你走人.賓館反饋2008年4月30日：尊敬的賓客：您好！感謝您對如家光大店的支援與認可，如家的理念就是“溫馨如家，潔淨似月”，我們會繼續努力，為您提供更優質服務。期待您的下次光臨並多提寶貴意見謝謝！',
  '去蘇州工作的時候，住過很多酒店。綜合比較來看，這家酒店還是比較舒服的。地理位置很方便，即使去新區也很近。出門的時候，酒店的服務員會幫忙叫計程車。雖然房間有點小，但是佈置的很溫馨舒適，很適合一個人出差時入住，床具也很舒服，可以保證休息。唯一不足的是，預定的時候不能知道房間是在主樓還是附樓。賓館反饋2008年5月9日：多謝您提出的寶貴意見。一般情況下，攜程預訂的標房我們是安排在東樓的，因為東樓是06年新開的，房間設施裝置均比較新，豪華房我們是安排在主樓的。如您在預訂時想知道安排哪棟樓，可以在訂單上提出，我們在回覆確認預訂時會為您註明的。期待您的再次光臨。',
  '攜程在這個酒店的價效比不是最好的，因為後面在火車站附近看到有做活動四星的，價格更便宜，但是做為198元，這個酒店的質量與別的城市三星相比，算是很不錯的',
  '酒店的位置較好，出了火車站坐8路車就能到酒店，酒店後門就是洋人街，交通很方便。裝修也很好，特別是前臺的白族小姐態度超好，早餐也很豐富。是個不錯的酒店，下次去的話還會去住。',
  '2007年12月底住的。地方在小路上，司機不一定找得到。屋裡黴味極重，房間髒，沒熱水。第二天他們告訴我，那間房是從業主那裡剛收回來的，沒準備好，不應該租給我的。怎麼不早說啊。（哦，這裡客房、業主、寫字全混在一起。一樓你要問事不小心問了物業而不是酒店前臺，他們還給你臉色看呢，暈！）我要退房，有位姓李的女經理死活拉著我接著住，賠不是，給我免費升級。你現在態度好，但是你們總體還是很差啊。樓頂的餐廳早飯絕對差，晚飯不知道，地方看起來就很怪，沒有人氣。總之，千萬別住在這裡，如果無改善的話！',
  '賓館大門顯得很時尚，大廳很有個性，房間也保持一樣的風格，綠色木紋和磚石牆面，簡單不失個性，很像快捷酒店。就價位來說很值得。',
  '不錯的酒店。每次去泉州都住的。早餐很豐盛。門口有大巴車站，交通方便。（但是大巴是中旅的，習慣很差，喜歡在市區兜來兜去到處接客，從一個站到另一個站，非常耽誤時間。商務客人最好去中心站坐車）',
  '剛剛結束4天的旅遊行，在YMCA的三天我非常滿意。首先是交通方便，出門口2分鐘就是地鐵口，而且這個油麻地站通兩條地鐵線。特別是早上可以坐地鐵去吃粥，晚上再晚也不擔心回不來。（這個地鐵站到12;45分關門）再次就是乾淨，不知道是不是新裝修的。牆面和床上靠墊的顏色非常協調。衛生間也夠大。（相對於一般的香港酒店）我們住的房間是三角形的，臥室和衛生間的燈光配合房間的結構佈置的很好。龍頭出水量很大，還有掛壁的吹風機，保險箱，小冰箱。。都不錯。還有是服務員的態度也很不錯。可能是因為這是基督教會所屬的酒店。所以每個迎面遇到的客人，都是面帶微笑，感覺很親切。總之有朋友去香港我一定會推薦這家，下次再去也會首選這家。',
  '高階大床房沒看到一點高階的地方。床墊彈簧很明顯的能感覺到，房間沒有大頂燈只靠2個昏暗的床頭燈照明，飲水壺和茶杯都放在衛生間裡很是讓人不舒服，茶杯裡的茶垢也不知道是哪天留下的，浴巾很舊顏色看上去都不忍目睹，第二天退房時告訴我房間3個枕套及床單上有汙物，和服務員一起重回房間他們拉開了房間的窗簾，這才看到枕套和床單上那些黑色的斑斑點點將我噁心到死。竟然說是我們弄的，晚上入住的時候沒有頂燈根本看不清楚房間狀況，白天這一看全是起雞皮疙瘩，還說是我們弄髒的要賠償，我反問他們你們收拾房間也看到了，我在房間裡留下的垃圾中是否有能夠造成這種汙染的物品，他們也沒法回答了。最後雖然是沒有讓我賠償，但是還是說是我們弄髒的讓人氣憤不已。以後不會選擇漢庭入住了。賓館反饋2008年5月30日：首先非常感謝客人的入住，對於在我店不愉快的經歷，我深表歉意！說明一下：一根彈簧的床墊一直是我們漢庭酒店的特色，已得到很多客人的肯定，但是每位客人的需求不一樣，希望客人能理解。房間的燈光我們也是特別設計的，為的是能給客人提供一個溫馨的睡眠環境，這個不用再做說明了。至於客人反映的三個枕套和床單是有汙漬，經我酒店查實汙漬是很明顯的頭髮挑染的紅色掉色。在這裡我也不想多做解釋是誰的責任。考慮到客人的心理，在禮貌提出賠償未果的情況下，我店做了報廢處理。我們的宗旨：服務第一！希望客人做出客觀評價，也希望更多地客人對我店監督指導。謝謝！',
  '地理位置客房狀況都不錯。前臺服務需要加強，缺乏靈活性，不能從客人的角度來思考問題。沒有接觸其他的服務，可能整體的軟環境都存在較大的提升空間。',
  '很滿意，環境很好，晚間無一個騷擾電話，是我住過的唯一無騷擾電話的酒店，也許是新酒店的緣故吧！',
  '由於天氣預報的不確定性，預定過程中更改了幾次時間，都順利完成。前臺服務態度非常好。度假村很氣派，環境極佳，可惜我們入住的時候正是下雨天，沒能好好享受一下跟美景的親密接觸。'),
 tensor([0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,
         0, 1, 1, 1, 0, 1, 1, 1])]
```





